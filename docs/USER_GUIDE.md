# 飞书AI机器人使用指南

欢迎使用飞书AI机器人！本指南将帮助你快速上手，充分利用机器人的各种功能。

## 目录

- [基础使用](#基础使用)
- [命令前缀](#命令前缀)
- [会话管理](#会话管理)
- [使用场景](#使用场景)
- [高级功能](#高级功能)
- [常见问题](#常见问题)

---

## 基础使用

### 发送消息

直接在飞书群聊中 @机器人 并发送消息即可：

```
@机器人 你好，请介绍一下自己
```

机器人会使用默认的 AI 提供商（通常是 Claude）回复你。

### 不使用命令前缀

如果不加任何命令前缀，机器人会：
1. 使用配置文件中的 `DEFAULT_PROVIDER`（默认 AI）
2. 使用配置文件中的 `DEFAULT_LAYER`（默认执行层）
3. 智能检测消息内容，如果包含代码操作关键词，自动切换到 CLI 层

---

## 命令前缀

通过在消息前添加命令前缀，你可以精确控制使用哪个 AI 和执行层。

### API 层命令（快速对话）

API 层适合快速对话、问答、创意写作等场景。

| 命令前缀 | AI 提供商 | 示例 |
|---------|----------|------|
| `@claude` | Claude API | `@claude 解释一下什么是依赖注入` |
| `@claude-api` | Claude API | `@claude-api 写一个 Python 装饰器` |
| `@gemini` | Gemini API | `@gemini 用 Java 实现单例模式` |
| `@gemini-api` | Gemini API | `@gemini-api 什么是微服务架构` |
| `@openai` | OpenAI API | `@openai 写一个快速排序算法` |
| `@gpt` | OpenAI API | `@gpt 解释一下 React Hooks` |

**使用示例**：
```
@claude 帮我写一个 Python 函数，计算斐波那契数列

@gemini 用 JavaScript 实现一个防抖函数

@gpt 解释一下什么是闭包
```

### CLI 层命令（代码操作）

CLI 层适合代码分析、文件操作、项目结构查看等场景。需要先配置目标项目目录。

| 命令前缀 | AI CLI | 目标目录配置 | 示例 |
|---------|--------|-------------|------|
| `@code` | Claude Code CLI | CLAUDE_CLI_TARGET_DIR | `@code 分析项目架构` |
| `@claude-cli` | Claude Code CLI | CLAUDE_CLI_TARGET_DIR | `@claude-cli 查看 main.py` |
| `@gemini-cli` | Gemini CLI | GEMINI_CLI_TARGET_DIR | `@gemini-cli 分析代码质量` |

**使用示例**：
```
@code 帮我查看一下 src/main.py 文件的内容

@code 分析一下这个项目的目录结构

@gemini-cli 检查代码中是否有潜在的 bug
```

---

## 会话管理

机器人会自动管理你的对话上下文，让 AI 记住之前的对话内容。

### 查看当前会话

```
/session
```

显示当前会话的信息：
- 会话 ID
- 消息数量
- 创建时间
- 最后活跃时间

### 创建新会话

```
/new
```

创建一个新的会话，清空之前的对话历史。适用于：
- 开始新的话题
- 当前会话消息过多，响应变慢
- 想要重新开始对话

### 查看历史记录

```
/history
```

显示当前会话的对话历史（最近 10 条）。

### 会话自动管理

机器人会自动管理会话：
- 单个会话最多保存 50 条消息（可配置）
- 超过限制后自动创建新会话
- 会话闲置 24 小时后自动过期（可配置）

---

## 使用场景

### 场景 1: 快速问答

**适合**: 概念解释、代码示例、技术咨询

```
@claude 什么是 Docker 容器？

@gemini 解释一下 RESTful API 的设计原则

@gpt 如何优化 SQL 查询性能？
```

### 场景 2: 代码编写

**适合**: 算法实现、函数编写、代码片段

```
@claude 用 Python 写一个二分查找算法

@gemini 用 Java 实现一个线程安全的单例模式

@gpt 用 JavaScript 写一个深拷贝函数
```

### 场景 3: 代码分析

**适合**: 项目分析、代码审查、架构理解

```
@code 分析一下这个项目的整体架构

@code 查看 src/utils/helper.py 文件，解释它的作用

@gemini-cli 检查项目中是否有代码重复
```

### 场景 4: 文件操作

**适合**: 查看文件、理解代码结构

```
@code 读取 README.md 文件的内容

@code 列出 src 目录下的所有 Python 文件

@gemini-cli 查看 package.json 的依赖项
```

### 场景 5: 项目理解

**适合**: 新项目上手、代码库探索

```
@code 这个项目是做什么的？主要功能有哪些？

@code 项目的入口文件是哪个？

@code 解释一下项目的目录结构
```

### 场景 6: 多 AI 对比

**适合**: 获取不同视角、对比不同方案

```
@claude 用 Python 实现一个 LRU 缓存

@gemini 用 Python 实现一个 LRU 缓存

@gpt 用 Python 实现一个 LRU 缓存
```

然后对比三个 AI 给出的不同实现方案。

### 场景 7: 混合使用

**适合**: 先咨询后实践、理论结合实际

```
# 第一步：咨询设计方案
@claude 我想重构这个项目的数据库层，有什么建议？

# 第二步：查看现有代码
@code 查看 models/database.py 的当前实现

# 第三步：继续讨论
@claude 基于现有代码，具体应该怎么重构？
```

---

## 高级功能

### 智能路由

机器人会根据消息内容自动选择合适的执行层：

**自动使用 CLI 层的关键词**：
- 代码相关：查看代码、分析代码、代码库
- 文件操作：修改文件、读取文件、创建文件
- 命令执行：执行命令、运行脚本
- 项目分析：分析项目、项目结构

**示例**：
```
# 不需要加 @code，机器人会自动识别
查看 src/main.py 文件的内容

# 机器人检测到"查看"和"文件"关键词，自动使用 CLI 层
```

### 多项目支持

如果配置了不同的 CLI 目标目录，可以在不同项目间切换：

```
# 操作后端项目（Claude CLI）
@code 分析后端项目的数据库设计

# 操作前端项目（Gemini CLI）
@gemini-cli 查看前端项目的组件结构
```

配置示例：
```bash
CLAUDE_CLI_TARGET_DIR=E:\Projects\backend-api
GEMINI_CLI_TARGET_DIR=E:\Projects\frontend-app
```

### 会话隔离

每个用户的会话是独立的，互不干扰：
- 你的对话历史只有你能看到
- 不同用户可以同时使用机器人
- 每个用户可以使用不同的 AI 提供商

### 降级策略

如果指定的 AI 不可用，机器人会自动降级：

```
@claude 你好

# 如果 Claude API 不可用，会自动尝试：
# 1. Claude CLI（如果配置了）
# 2. 其他可用的 API
```

---

## 命令速查表

### 会话管理命令

| 命令 | 功能 | 示例 |
|------|------|------|
| `/session` | 查看当前会话信息 | `/session` |
| `/new` | 创建新会话 | `/new` |
| `/history` | 查看对话历史 | `/history` |

### API 层命令（快速对话）

| 命令 | AI | 说明 |
|------|-----|------|
| `@claude` | Claude | 推荐用于复杂推理 |
| `@gemini` | Gemini | 推荐用于多模态任务 |
| `@openai` / `@gpt` | OpenAI | 推荐用于通用对话 |

### CLI 层命令（代码操作）

| 命令 | CLI | 说明 |
|------|-----|------|
| `@code` | Claude Code CLI | 推荐用于代码分析 |
| `@claude-cli` | Claude Code CLI | 同上（显式） |
| `@gemini-cli` | Gemini CLI | Gemini 代码操作 |

---

## 使用技巧

### 1. 明确你的需求

**好的提问**：
```
@claude 用 Python 实现一个单例模式，要求线程安全，并解释实现原理
```

**不够好的提问**：
```
@claude 单例
```

### 2. 提供上下文

**好的提问**：
```
@code 我在 src/utils/cache.py 中实现了一个 LRU 缓存，
但是性能不太好，帮我分析一下可能的原因
```

**不够好的提问**：
```
@code 缓存性能不好
```

### 3. 分步骤进行

对于复杂任务，分步骤提问：

```
# 第一步：了解现状
@code 分析项目的测试覆盖率

# 第二步：制定方案
@claude 基于当前测试覆盖率，如何提高到 80%？

# 第三步：查看具体文件
@code 查看 tests/test_main.py 的内容

# 第四步：继续讨论
@claude 这个测试文件还缺少哪些测试用例？
```

### 4. 利用会话上下文

机器人会记住对话历史，可以连续提问：

```
你: @claude 什么是依赖注入？
AI: [解释依赖注入的概念]

你: 能举个 Python 的例子吗？
AI: [提供 Python 示例]

你: 这种方式有什么优缺点？
AI: [分析优缺点]
```

### 5. 切换 AI 获取不同视角

```
@claude 这段代码有什么问题？
[Claude 的分析]

@gemini 你觉得这段代码有什么问题？
[Gemini 的分析]

@gpt 你的看法呢？
[GPT 的分析]
```

### 6. 使用智能路由

对于代码操作，可以省略 `@code`：

```
# 这两种写法效果相同
@code 查看 src/main.py

查看 src/main.py
# 机器人会自动识别并使用 CLI 层
```

---

## 常见问题

### Q1: 机器人没有回复我？

**可能原因**：
1. 没有 @机器人
2. 机器人不在该群聊中
3. AI API 密钥未配置或无效
4. 网络连接问题

**解决方法**：
- 确保消息中 @了机器人
- 检查机器人是否在群聊中
- 查看机器人日志确认错误信息
- 联系管理员检查配置

### Q2: CLI 层命令不工作？

**可能原因**：
1. 未配置目标项目目录
2. 目标目录不存在或无权访问
3. CLI 工具未安装

**解决方法**：
- 检查 `.env` 文件中的 `TARGET_PROJECT_DIR` 配置
- 确保目录路径正确且可访问
- 安装对应的 CLI 工具（Claude Code CLI 或 Gemini CLI）

### Q3: 如何切换到新话题？

使用 `/new` 命令创建新会话：

```
/new
```

### Q4: 机器人回复太慢？

**可能原因**：
1. 会话消息过多，上下文太长
2. 使用了 CLI 层（比 API 层慢）
3. AI 服务响应慢

**解决方法**：
- 使用 `/new` 创建新会话
- 对于简单问题使用 API 层（`@claude`、`@gemini`、`@gpt`）
- 等待或稍后重试

### Q5: 如何查看我问了什么？

使用 `/history` 命令：

```
/history
```

### Q6: 不同的 AI 有什么区别？

| AI | 特点 | 适合场景 |
|----|------|---------|
| Claude | 推理能力强，代码质量高 | 复杂问题、代码分析、架构设计 |
| Gemini | 多模态支持，响应快 | 通用对话、快速问答 |
| OpenAI | 通用性强，生态完善 | 各类场景，特别是创意写作 |

### Q7: CLI 层和 API 层有什么区别？

| 特性 | API 层 | CLI 层 |
|------|--------|--------|
| 响应速度 | 快（秒级） | 慢（分钟级） |
| 代码能力 | 基础 | 强大 |
| 文件操作 | 不支持 | 支持 |
| 项目分析 | 不支持 | 支持 |
| 适合场景 | 对话、问答、代码示例 | 代码分析、文件操作、项目理解 |

### Q8: 如何操作不同的项目？

配置不同的 CLI 目标目录：

```bash
# .env 文件
CLAUDE_CLI_TARGET_DIR=E:\Projects\project-a
GEMINI_CLI_TARGET_DIR=E:\Projects\project-b
```

然后使用不同的命令：
```
@code 分析 project-a 的架构
@gemini-cli 查看 project-b 的代码
```

### Q9: 会话会保存多久？

- 会话闲置 24 小时后自动过期（可配置）
- 单个会话最多保存 50 条消息（可配置）
- 超过限制后自动创建新会话

### Q10: 如何获得更好的回复？

**提问技巧**：
1. 明确具体：说清楚你想要什么
2. 提供上下文：给出相关背景信息
3. 分步骤：复杂问题分解成小问题
4. 利用历史：在同一会话中连续提问
5. 尝试不同 AI：获取多个视角

---

## 更多帮助

- **配置指南**: 查看 [CONFIGURATION.md](CONFIGURATION.md)
- **测试指南**: 查看 [INTEGRATION_TESTING_GUIDE.md](INTEGRATION_TESTING_GUIDE.md)
- **项目文档**: 查看 [README.md](../README.md)
- **设计文档**: 查看 `.kiro/specs/feishu-ai-bot/design.md`

---

## 反馈与建议

如果你在使用过程中遇到问题或有改进建议，欢迎：
- 在群聊中反馈
- 提交 Issue
- 联系管理员

祝你使用愉快！🎉
